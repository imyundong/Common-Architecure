''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' File          : CTeller.vb
' Class         : CTeller
' Description   : Table    Teller
'               : Database SQLServer
'               : This Class is Generated By DBCG Tools Automatically
' Author        : Su Jia
' Creation Ver  : 2.1.0.0
'
' Revision History
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
' Version       Date                 User
' $Log: CTeller.vb,v $
' Revision 1.0  2012/08/24           Su Jia
' Initial Version
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Imports ServerPlatform.Library.Utility
Imports ServerPlatform.Library.Workflow.CError

Public Class CTellerSQLServer
    Inherits CTellerStruct
    Implements IDatabaseAccess
    Implements IComponent

    Public Sub Insert(ByVal Adapter As IDatabaseAdapter, ByRef Obj As Object) _
        Implements IDatabaseAccess.Insert

        Dim StructObj As CTellerStruct = TryCast(Obj, CTellerStruct)

        Dim SQL As New Text.StringBuilder
        SQL.Append(" INSERT INTO Teller ")
        SQL.Append("    ( ")
        SQL.Append("    [TellerId], ")
        SQL.Append("    [BranchId], ")
        SQL.Append("    [Enabled], ")
        SQL.Append("    [TellerName], ")
        SQL.Append("    [TerminalId], ")
        SQL.Append("    [Capability], ")
        SQL.Append("    [HostTellerId], ")
        SQL.Append("    [LeaveDate]) ")
        SQL.Append(" VALUES ")
        SQL.Append("    ( ")
        SQL.Append("    @TellerId, ")
        SQL.Append("    @BranchId, ")
        SQL.Append("    @Enabled, ")
        SQL.Append("    @TellerName, ")
        SQL.Append("    @TerminalId, ")
        SQL.Append("    @Capability, ")
        SQL.Append("    @HostTellerId, ")
        SQL.Append("    @LeaveDate) ")

        Dim Command As SqlClient.SqlCommand = Adapter.Command()

        Command.CommandType = CommandType.Text
        Command.CommandText = SQL.ToString
        Command.Parameters.AddWithValue("TellerId", StructObj.TellerId)
        Command.Parameters.AddWithValue("BranchId", StructObj.BranchId)
        Command.Parameters.AddWithValue("Enabled", StructObj.Enabled)
        Command.Parameters.AddWithValue("TellerName", StructObj.TellerName)
        Command.Parameters.AddWithValue("TerminalId", StructObj.TerminalId)
        Command.Parameters.AddWithValue("Capability", StructObj.Capability)
        Command.Parameters.AddWithValue("HostTellerId", StructObj.HostTellerId)
        Command.Parameters.AddWithValue("LeaveDate", StructObj.LeaveDate)

        Try
            Dim Counter As Integer = Command.ExecuteNonQuery()
            If Counter <> 1 Then
                Throw New CBusinessException(CErrorCode.DATABASE_INSERT_FAIL, "0 Record Inserted")
            End If
        Catch ex As Exception
            CLog.Err(ex.Message)
            Throw New CBusinessException(CErrorCode.DATABASE_INSERT_FAIL, ex)
        End Try
    End Sub

    Public Sub Update(ByVal Adapter As IDatabaseAdapter, ByRef Obj As Object) _
        Implements IDatabaseAccess.Update

        Dim StructObj As CTellerStruct = TryCast(Obj, CTellerStruct)

        Dim SQL As New Text.StringBuilder
        SQL.Append(" UPDATE Teller ")
        SQL.Append(" SET ")
        SQL.Append("     [BranchId] = @BranchId, ")
        SQL.Append("     [Enabled] = @Enabled, ")
        SQL.Append("     [TellerName] = @TellerName, ")
        SQL.Append("     [TerminalId] = @TerminalId, ")
        SQL.Append("     [Capability] = @Capability, ")
        SQL.Append("     [HostTellerId] = @HostTellerId, ")
        SQL.Append("     [LeaveDate] = @LeaveDate ")
        SQL.Append(" WHERE ")
        SQL.Append("     [TellerId] = @TellerId ")

        Dim Command As SqlClient.SqlCommand = Adapter.Command()

        Command.CommandType = CommandType.Text
        Command.CommandText = SQL.ToString
        Command.Parameters.AddWithValue("TellerId", StructObj.TellerId)
        Command.Parameters.AddWithValue("BranchId", StructObj.BranchId)
        Command.Parameters.AddWithValue("Enabled", StructObj.Enabled)
        Command.Parameters.AddWithValue("TellerName", StructObj.TellerName)
        Command.Parameters.AddWithValue("TerminalId", StructObj.TerminalId)
        Command.Parameters.AddWithValue("Capability", StructObj.Capability)
        Command.Parameters.AddWithValue("HostTellerId", StructObj.HostTellerId)
        Command.Parameters.AddWithValue("LeaveDate", StructObj.LeaveDate)

        Try
            Dim Counter As Integer = Command.ExecuteNonQuery()
            If Counter <> 1 Then
                Throw New CBusinessException(CErrorCode.DATABASE_UPDATE_FAIL, "0 Record Updated")
            End If
        Catch ex As Exception
            CLog.Err(ex.Message)
            Throw New CBusinessException(CErrorCode.DATABASE_UPDATE_FAIL, ex)
        End Try
    End Sub

    Public Sub Remove(ByVal Adapter As IDatabaseAdapter, ByRef Obj As Object) _
        Implements IDatabaseAccess.Remove

        Dim StructObj As CTellerStruct = TryCast(Obj, CTellerStruct)

        Dim SQL As New Text.StringBuilder
        SQL.Append(" DELETE FROM Teller ")
        SQL.Append(" WHERE ")
        SQL.Append("     [TellerId] = @TellerId ")

        Dim Command As SqlClient.SqlCommand = Adapter.Command

        Command.CommandType = CommandType.Text
        Command.CommandText = SQL.ToString
        Command.Parameters.AddWithValue("TellerId", StructObj.TellerId)

        Try
            Dim Counter As Integer = Command.ExecuteNonQuery()
            If Counter <> 1 Then
                Throw New CBusinessException(CErrorCode.DATABASE_UPDATE_FAIL, "0 Record Deleted")
            End If
        Catch ex As Exception
            CLog.Err(ex.Message)
            Throw New CBusinessException(CErrorCode.DATABASE_DELETE_FAIL, ex)
        End Try
    End Sub

    Public Sub Search(ByVal Adapter As IDatabaseAdapter, _
                           ByRef Obj As Object, ByVal Lock As Boolean?) Implements IDatabaseAccess.Search

        Dim StructObj As CTellerStruct = TryCast(Obj, CTellerStruct)

        Dim SQL As New Text.StringBuilder
        SQL.Append(" SELECT ")
        SQL.Append("    [TellerId], ")
        SQL.Append("    [BranchId], ")
        SQL.Append("    [Enabled], ")
        SQL.Append("    [TellerName], ")
        SQL.Append("    [TerminalId], ")
        SQL.Append("    [Capability], ")
        SQL.Append("    [HostTellerId], ")
        SQL.Append("    [LeaveDate] ")
        SQL.Append(" FROM ")
        SQL.Append("     Teller ")
        If Lock Is Nothing Then
            SQL.Append(" WITH (NOLOCK) ")
        ElseIf Lock = True Then
            SQL.Append(" WITH (ROWLOCK) ")
        End If
        SQL.Append(" WHERE")
        SQL.Append("     [TellerId] = @TellerId ")

        Dim Command As SqlClient.SqlCommand = Adapter.Command

        Command.CommandType = CommandType.Text
        Command.CommandText = SQL.ToString
        Command.Parameters.AddWithValue("TellerId", StructObj.TellerId)

        Dim SQLAdapter As SqlClient.SqlDataAdapter = Adapter.Adapter
        SQLAdapter.SelectCommand = Command

        Dim Data As New DataSet
        Try
            SQLAdapter.Fill(Data)
        Catch ex As Exception
            CLog.Err(ex.Message)
            Throw New CBusinessException(CErrorCode.DATABASE_QUERY_FAIL, ex)
        End Try

        Dim Row As Data.DataRowCollection = Data.Tables(0).Rows
        If Row.Count = 0 Then
            Throw New CBusinessException(CErrorCode.RECORD_NOT_FOUND, "Record Not Found")
        End If

        If Not IsDBNull(Row(0).Item(0)) Then StructObj.TellerId = Row(0).Item(0)
        If Not IsDBNull(Row(0).Item(1)) Then StructObj.BranchId = Row(0).Item(1)
        If Not IsDBNull(Row(0).Item(2)) Then StructObj.Enabled = Row(0).Item(2)
        If Not IsDBNull(Row(0).Item(3)) Then StructObj.TellerName = Row(0).Item(3)
        If Not IsDBNull(Row(0).Item(4)) Then StructObj.TerminalId = Row(0).Item(4)
        If Not IsDBNull(Row(0).Item(5)) Then StructObj.Capability = Row(0).Item(5)
        If Not IsDBNull(Row(0).Item(6)) Then StructObj.HostTellerId = Row(0).Item(6)
        If Not IsDBNull(Row(0).Item(7)) Then StructObj.LeaveDate = Row(0).Item(7)
    End Sub

    Public Sub SearchAll(ByVal Adapter As IDatabaseAdapter, _
                         ByRef DatabaseObj As List(Of Object)) Implements IDatabaseAccess.SearchAll

        Dim SQL As New Text.StringBuilder
        SQL.Append(" SELECT ")
        SQL.Append("    [TellerId], ")
        SQL.Append("    [BranchId], ")
        SQL.Append("    [Enabled], ")
        SQL.Append("    [TellerName], ")
        SQL.Append("    [TerminalId], ")
        SQL.Append("    [Capability], ")
        SQL.Append("    [HostTellerId], ")
        SQL.Append("    [LeaveDate] ")
        SQL.Append(" FROM ")
        SQL.Append("     Teller ")

        Dim Command As SqlClient.SqlCommand = Adapter.Command

        Command.CommandType = CommandType.Text
        Command.CommandText = SQL.ToString

        Dim SQLAdapter As SqlClient.SqlDataAdapter = Adapter.Adapter
        SQLAdapter.SelectCommand = Command

        Dim Data As New DataSet
        Try
            SQLAdapter.Fill(Data)
        Catch ex As Exception
            CLog.Err(ex.Message)
            Throw New CBusinessException(CErrorCode.DATABASE_QUERY_FAIL, ex)
        End Try

        Dim Rows As Data.DataRowCollection = Data.Tables(0).Rows
        If Rows.Count = 0 Then
            Throw New CBusinessException(CErrorCode.RECORD_NOT_FOUND, "Record Not Found")
        End If

        For Each Row As DataRow In Rows
            Dim StructObj As New CTellerStruct
            If Not IsDBNull(Row.Item(0)) Then StructObj.TellerId = Row.Item(0)
            If Not IsDBNull(Row.Item(1)) Then StructObj.BranchId = Row.Item(1)
            If Not IsDBNull(Row.Item(2)) Then StructObj.Enabled = Row.Item(2)
            If Not IsDBNull(Row.Item(3)) Then StructObj.TellerName = Row.Item(3)
            If Not IsDBNull(Row.Item(4)) Then StructObj.TerminalId = Row.Item(4)
            If Not IsDBNull(Row.Item(5)) Then StructObj.Capability = Row.Item(5)
            If Not IsDBNull(Row.Item(6)) Then StructObj.HostTellerId = Row.Item(6)
            If Not IsDBNull(Row.Item(7)) Then StructObj.LeaveDate = Row.Item(7)
            DatabaseObj.Add(StructObj)
        Next
    End Sub

    Public Sub SearchByEnabled(ByVal Adapter As IDatabaseAdapter, _
                                      ByVal Obj As CTellerStruct, _
                                      ByRef TellerList As List(Of Object), _
                                      ByVal Lock As Boolean?) _

        Dim StructObj As CTellerStruct = TryCast(Obj, CTellerStruct)
        TellerList.Clear()

        Dim SQL As New Text.StringBuilder
        SQL.Append(" SELECT ")
        If StructObj.MaxRecord > 0 Then SQL.Append(" TOP " & StructObj.MaxRecord)
        SQL.Append("    [TellerId], ")
        SQL.Append("    [BranchId], ")
        SQL.Append("    [Enabled], ")
        SQL.Append("    [TellerName], ")
        SQL.Append("    [TerminalId], ")
        SQL.Append("    [Capability], ")
        SQL.Append("    [HostTellerId], ")
        SQL.Append("    [LeaveDate]  ")
        SQL.Append(" FROM ")
        SQL.Append("     Teller ")
        If Lock Is Nothing Then
            SQL.Append(" WITH (NOLOCK) ")
        ElseIf Lock = True Then
            SQL.Append(" WITH (ROWLOCK) ")
        End If
        SQL.Append(" WHERE ")
        SQL.Append("     ( ")
        SQL.Append("     [Enabled] = ")
        SQL.Append("       @Enabled ")
        SQL.Append("     ) ")

        Dim Command As SqlClient.SqlCommand = Adapter.Command

        Command.CommandType = CommandType.Text
        Command.CommandText = SQL.ToString
        Command.Parameters.AddWithValue("Enabled", StructObj.Enabled)

        Dim SQLAdapter As SqlClient.SqlDataAdapter = Adapter.Adapter
        SQLAdapter.SelectCommand = Command

        Dim Data As New DataSet
        Try
            SQLAdapter.Fill(Data)
        Catch ex As Exception
            CLog.Err(ex.Message)
            Throw New CBusinessException(CErrorCode.DATABASE_QUERY_FAIL, ex)
        End Try

        Dim Row As DataRowCollection = Data.Tables(0).Rows
        If Row.Count = 0 Then
            Throw New CBusinessException(CErrorCode.RECORD_NOT_FOUND, "Record Not Found")
        End If

        For Idx As Integer = 0 To Data.Tables(0).Rows.Count - 1
            Dim DBStruct As New CTellerStruct

            If Not IsDBNull(Row(Idx).Item(0)) Then DBStruct.TellerId = Row(Idx).Item(0)
            If Not IsDBNull(Row(Idx).Item(1)) Then DBStruct.BranchId = Row(Idx).Item(1)
            If Not IsDBNull(Row(Idx).Item(2)) Then DBStruct.Enabled = Row(Idx).Item(2)
            If Not IsDBNull(Row(Idx).Item(3)) Then DBStruct.TellerName = Row(Idx).Item(3)
            If Not IsDBNull(Row(Idx).Item(4)) Then DBStruct.TerminalId = Row(Idx).Item(4)
            If Not IsDBNull(Row(Idx).Item(5)) Then DBStruct.Capability = Row(Idx).Item(5)
            If Not IsDBNull(Row(Idx).Item(6)) Then DBStruct.HostTellerId = Row(Idx).Item(6)
            If Not IsDBNull(Row(Idx).Item(7)) Then DBStruct.LeaveDate = Row(Idx).Item(7)

            TellerList.Add(DBStruct)
        Next

    End Sub

    Public Sub SearchBySameBranchEnabledCpaOver5(ByVal Adapter As IDatabaseAdapter, _
                                      ByVal Obj As CTellerStruct, _
                                      ByRef TellerList As List(Of Object), _
                                      ByVal Lock As Boolean?) _

        Dim StructObj As CTellerStruct = TryCast(Obj, CTellerStruct)
        TellerList.Clear()

        Dim SQL As New Text.StringBuilder
        SQL.Append(" SELECT ")
        If StructObj.MaxRecord > 0 Then SQL.Append(" TOP " & StructObj.MaxRecord)
        SQL.Append("    [TellerId], ")
        SQL.Append("    [BranchId], ")
        SQL.Append("    [Enabled], ")
        SQL.Append("    [TellerName], ")
        SQL.Append("    [TerminalId], ")
        SQL.Append("    [Capability], ")
        SQL.Append("    [HostTellerId], ")
        SQL.Append("    [LeaveDate]  ")
        SQL.Append(" FROM ")
        SQL.Append("     Teller ")
        If Lock Is Nothing Then
            SQL.Append(" WITH (NOLOCK) ")
        ElseIf Lock = True Then
            SQL.Append(" WITH (ROWLOCK) ")
        End If
        SQL.Append(" WHERE ")
        SQL.Append("     ( ")
        SQL.Append("     [Enabled] = ")
        SQL.Append("       @Enabled ")
        SQL.Append("     AND ")
        SQL.Append("     [BranchId] = ")
        SQL.Append("       @BranchId ")
        SQL.Append("     AND ")
        SQL.Append("     [Capability] >= ")
        SQL.Append("       @Capability ")
        SQL.Append("     ) ")

        Dim Command As SqlClient.SqlCommand = Adapter.Command

        Command.CommandType = CommandType.Text
        Command.CommandText = SQL.ToString
        Command.Parameters.AddWithValue("Enabled", StructObj.Enabled)
        Command.Parameters.AddWithValue("BranchId", StructObj.BranchId)
        Command.Parameters.AddWithValue("Capability", StructObj.Capability)

        Dim SQLAdapter As SqlClient.SqlDataAdapter = Adapter.Adapter
        SQLAdapter.SelectCommand = Command

        Dim Data As New DataSet
        Try
            SQLAdapter.Fill(Data)
        Catch ex As Exception
            CLog.Err(ex.Message)
            Throw New CBusinessException(CErrorCode.DATABASE_QUERY_FAIL, ex)
        End Try

        Dim Row As DataRowCollection = Data.Tables(0).Rows
        If Row.Count = 0 Then
            Throw New CBusinessException(CErrorCode.RECORD_NOT_FOUND, "Record Not Found")
        End If

        For Idx As Integer = 0 To Data.Tables(0).Rows.Count - 1
            Dim DBStruct As New CTellerStruct

            If Not IsDBNull(Row(Idx).Item(0)) Then DBStruct.TellerId = Row(Idx).Item(0)
            If Not IsDBNull(Row(Idx).Item(1)) Then DBStruct.BranchId = Row(Idx).Item(1)
            If Not IsDBNull(Row(Idx).Item(2)) Then DBStruct.Enabled = Row(Idx).Item(2)
            If Not IsDBNull(Row(Idx).Item(3)) Then DBStruct.TellerName = Row(Idx).Item(3)
            If Not IsDBNull(Row(Idx).Item(4)) Then DBStruct.TerminalId = Row(Idx).Item(4)
            If Not IsDBNull(Row(Idx).Item(5)) Then DBStruct.Capability = Row(Idx).Item(5)
            If Not IsDBNull(Row(Idx).Item(6)) Then DBStruct.HostTellerId = Row(Idx).Item(6)
            If Not IsDBNull(Row(Idx).Item(7)) Then DBStruct.LeaveDate = Row(Idx).Item(7)

            TellerList.Add(DBStruct)
        Next

    End Sub

    Public Sub SearchByBranch(ByVal Adapter As IDatabaseAdapter, _
                                      ByVal Obj As CTellerStruct, _
                                      ByRef TellerList As List(Of Object), _
                                      ByVal Lock As Boolean?) _

        Dim StructObj As CTellerStruct = TryCast(Obj, CTellerStruct)
        TellerList.Clear()

        Dim SQL As New Text.StringBuilder
        SQL.Append(" SELECT ")
        If StructObj.MaxRecord > 0 Then SQL.Append(" TOP " & StructObj.MaxRecord)
        SQL.Append("    [TellerId], ")
        SQL.Append("    [BranchId], ")
        SQL.Append("    [Enabled], ")
        SQL.Append("    [TellerName], ")
        SQL.Append("    [TerminalId], ")
        SQL.Append("    [Capability], ")
        SQL.Append("    [HostTellerId], ")
        SQL.Append("    [LeaveDate]  ")
        SQL.Append(" FROM ")
        SQL.Append("     Teller ")
        If Lock Is Nothing Then
            SQL.Append(" WITH (NOLOCK) ")
        ElseIf Lock = True Then
            SQL.Append(" WITH (ROWLOCK) ")
        End If
        SQL.Append(" WHERE ")
        SQL.Append("     ( ")
        SQL.Append("     [BranchId] = ")
        SQL.Append("       @BranchId ")
        SQL.Append("     ) ")

        Dim Command As SqlClient.SqlCommand = Adapter.Command

        Command.CommandType = CommandType.Text
        Command.CommandText = SQL.ToString
        Command.Parameters.AddWithValue("BranchId", StructObj.BranchId)

        Dim SQLAdapter As SqlClient.SqlDataAdapter = Adapter.Adapter
        SQLAdapter.SelectCommand = Command

        Dim Data As New DataSet
        Try
            SQLAdapter.Fill(Data)
        Catch ex As Exception
            CLog.Err(ex.Message)
            Throw New CBusinessException(CErrorCode.DATABASE_QUERY_FAIL, ex)
        End Try

        Dim Row As DataRowCollection = Data.Tables(0).Rows
        If Row.Count = 0 Then
            Throw New CBusinessException(CErrorCode.RECORD_NOT_FOUND, "Record Not Found")
        End If

        For Idx As Integer = 0 To Data.Tables(0).Rows.Count - 1
            Dim DBStruct As New CTellerStruct

            If Not IsDBNull(Row(Idx).Item(0)) Then DBStruct.TellerId = Row(Idx).Item(0)
            If Not IsDBNull(Row(Idx).Item(1)) Then DBStruct.BranchId = Row(Idx).Item(1)
            If Not IsDBNull(Row(Idx).Item(2)) Then DBStruct.Enabled = Row(Idx).Item(2)
            If Not IsDBNull(Row(Idx).Item(3)) Then DBStruct.TellerName = Row(Idx).Item(3)
            If Not IsDBNull(Row(Idx).Item(4)) Then DBStruct.TerminalId = Row(Idx).Item(4)
            If Not IsDBNull(Row(Idx).Item(5)) Then DBStruct.Capability = Row(Idx).Item(5)
            If Not IsDBNull(Row(Idx).Item(6)) Then DBStruct.HostTellerId = Row(Idx).Item(6)
            If Not IsDBNull(Row(Idx).Item(7)) Then DBStruct.LeaveDate = Row(Idx).Item(7)

            TellerList.Add(DBStruct)
        Next

    End Sub

    Public Function Count(ByVal Adapter As IDatabaseAdapter) As Integer Implements IDatabaseAccess.Count

        Dim SQL As New Text.StringBuilder
        SQL.Append(" SELECT ")
        SQL.Append("     COUNT(*) ")
        SQL.Append(" FROM ")
        SQL.Append("     Teller ")

        Dim Command As SqlClient.SqlCommand = Adapter.Command

        Command.CommandType = CommandType.Text
        Command.CommandText = SQL.ToString
        
        Try
            Dim Counter As Integer = Command.ExecuteScalar()
            Return Count
        Catch ex As Exception
            CLog.Err(ex.Message)
            Throw New CBusinessException(CErrorCode.DATABASE_QUERY_FAIL, ex)
        End Try
        
    End Function

    Public ReadOnly Property Name As String Implements IComponent.Name
        Get
            Return "SQLServer_Teller"
        End Get
    End Property

End Class

